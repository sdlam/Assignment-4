---
title: "Assignment 3 Task 2"
author: "Sarah Lam"
date: "11/4/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(kableExtra)
library(lubridate)
library(ggbeeswarm)
library(effsize)
library(broom)
```


# 1. Overview

Introduction: A 4 - 5 sentence "mini-introduction" to what this study is exploring, including basic background information about the subject, site and study (with citations as needed), and a brief overview of what is included in the exploratory report. You should probably do this last so you know what’s contained in the report.

# 2. Data

A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.

"Bonanza Creek LTER is part of the US Long Term Ecological Research Network. See more information about the site here. In this “mini exploratory report,” you will explore the counts and sizes of juvenile snowshoe hares recorded from 1998 - 2012. The data citation and link to metadata (including variable definitions) are below."

Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

```{r}
hares <- read_csv(here("data", "bonanza_hares.csv"))
```

# 3. Preliminary Results
## A. Juvenile hare trapping data 

Annual juvenile hare trap counts. Count the total number of juvenile hare trappings during each year of the study, and create a finalized data visualization of the counts by year. Include a figure caption below the figure in your report. 
```{r fig.cap = "this figure shows..."}
juvenile_traps <- hares %>% 
  filter(age == "j") %>% 
  mutate(date_class = mdy(date)) %>% 
  mutate(year = year(date_class)) %>% 
  group_by(year) %>% 
  summarize(count = n())
  
ggplot(data = juvenile_traps, aes(x = year, y = count)) +
  geom_line(color = "cadetblue4", size = 1.5) +
  scale_x_continuous(breaks = 1999:2012) +
  theme_minimal() +
  labs(x = "Year",
       y = "Juvenile Hares Trapped")
```

Then, in 3 - 4 sentences below your figure, describe major takeaways from your graph about total snowshoe hare trappings at the site. You might consider:

What were the minimum and maximum counts of juvenile hare trappings?
Mean or median annual number of juvenile hares trapped?
General/notable trends?
These are absolute counts, but this count is also impacted by effort (e.g. the number of days and number of traps in the study each year). What would you suggest be done moving forward (you are not expected to actually do this) to standardize the juvenile hare population in future analyses?

## B. Juvenile hare weight comparison and descriptive statistics

```{r, fig.cap = "}
juvenile_hares <- hares %>% 
  filter(age == "j") %>% 
  mutate(sex = case_when(sex == "f" ~ "female",
                        sex == "m" ~ "male")) %>% 
  mutate(grid_full = case_when(grid == "bonrip" ~ "Riparian Habitat", 
                               grid == "bonmat" ~ "Mature Stand Habitat", 
                               grid == "bonbs" ~ "Black Spruce Habitat"))

ggplot(data = juvenile_hares, aes(x = sex, y = weight)) +
  geom_beeswarm(aes(color = sex), 
                show.legend = FALSE) +
  facet_wrap(~grid_full) +
  scale_color_manual(values = c("coral1","aquamarine","gray88")) +
  geom_boxplot(fill = NA, width = 0.2, outlier.color = NA) +
  theme_linedraw() +
   stat_summary(fun=mean, 
               geom="point", 
               shape=20, 
               size=4, 
               color="black", 
               fill="black") +
  labs(x = "Hare Sex", 
       y = "Weight (g)")
```

Then, in 2 - 3 sentences below your visualization(s) describe in text the main takeaways that you would want the audience to understand from your figures.

Note: There are multiple ways to visualize these comparisons. We encourage you to think carefully then make decisions about how to visualize these comparisons, including:

Can I use faceting to simplify the comparisons into manageable pieces?
Am I showing the audience the data, summary statistics, or both?
Have I updated graph labels, headers in facets, etc. to make it as straightforward as possible for viewers?
Have I simplified and finalized my data visualization(s) to include components that are useful for the audience?

```{r}
hares_summary <- juvenile_hares %>% 
  group_by(sex) %>% 
  summarize(mean_weight = round(mean(weight, na.rm = TRUE),2),
            sd_weight = round(sd(weight, na.rm = TRUE),2),
            median_weight = round(median(weight, na.rm = TRUE),2),
            n = n())

hares_summary %>% 
  kable(col.names = c("Sex",
                      "Mean Weight (g)",
                      "Median Weight (g)",
                      "Standard Deviation",
                      "Sample Size (n)"),
        caption = "Fig. 3. This table shows a summary of the mean hare weight (g), median hare weight (g), the standard deviation, and the sample size for male and female hares.") %>% 
  kable_styling(full_width = FALSE)
```
 
```{r include = FALSE}
# Runnign a t-test
m_juvenile <- juvenile_hares %>% # Pull vectors of weights for male & female juvenile hares
  filter(sex == "male") %>% 
  pull(weight)

f_juvenile <- juvenile_hares %>% 
  filter(sex == "female") %>% 
  pull(weight)

# Plot histograms & qq-plots to check assumptions
hist(m_juvenile) # Looks normal
qqnorm(m_juvenile) # Relatively linear
hist(f_juvenile) # Possibly a bit negatively skewed
qqnorm(f_juvenile) # Looks very linear

# Overall: assumptions of normality hold, & sample size additionally >> Central Limit Theorem (means will be normally distributed). Two-sample t-test OK for means comparison! 

# Run the t-test:
hares_ttest <- t.test(m_juvenile, f_juvenile)

# Get the tidy model results to call outputs in-line: 
hares_ttest_tidy <- tidy(hares_ttest)

# Get the means & SDs for each: 
male_mean <- mean(m_juvenile)
female_mean <- mean(f_juvenile)
male_sd <- sd(m_juvenile)
female_sd <- sd(f_juvenile)

# Get the effect size: 
hares_effsize <- cohen.d(m_juvenile, f_juvenile)
```

On average, adult male gentoo penguins have longer flippers than adult female gentoos (`r round(male_mean,2)` $\pm$ `r round(male_sd, 2)` and `r round(female_mean,2)` $\pm$ `r round(female_sd, 2)` mm, respectively; mean $\pm$ 1 standard deviation). While the absolute difference in means is `r round(male_mean, 2) - round(female_mean, 2)` mm (a `r round((male_mean - female_mean)/((male_mean + female_mean)/2)*100, 2)`% difference), the difference in means is significant (Welch's two-sample t-test: t(`r round(gentoo_ttest_tidy$parameter,2)`) = `r round(gentoo_ttest_tidy$statistic,2)`, p < 0.001), and the effect size is large (Cohen's *d* = `r round(gentoo_effsize$estimate,2)`).

```{r include = FALSE}
# Another way to manually make exploratory graphs and think about normality
ggplot(data = juvenile_hares, aes(x = weight)) +
  geom_histogram(bins = 12) +
  facet_wrap(~ sex)

ggplot(data = juvenile_hares, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~ sex)
```


```{r}
ggplot(data = juvenile_hares, aes(x = hindft, y = weight)) +
  geom_point(aes(color = sex, pch = sex)) +
   scale_shape_manual(values = c(16,17,18), 
                     name = "Hare Sex") +
  scale_color_manual(values = c("goldenrod2","cyan4","grey6"), 
                     name = "Hare Sex") +
  labs(x = "Hind Foot Length (mm)",
       y = "Hare Weight (g)") +
  theme_minimal() 
```

Upon seeing your graph, your “boss” tells you to try out linear regression to describe how juvenile snowshoe hare weight changes with respect to hind foot length. Try it out (the only variables you are expected to include here are hind foot length and weight, using data for all juvenile hares in the data, e.g. you are not expected to explore impacts of sex, site, etc.), and check the model diagnostics.

```{r}
# Do linear regression
hares_lm <- lm(weight ~ hindft, data = juvenile_hares)

# Get tidy versions of the model output to call later on in text
hares_lm_tidy <- tidy(hares_lm)
hares_lm_glance <- glance(hares_lm)

# See model diagnostics:
plot(hares_lm)

# Get Pearson's r correlation
hares_cor <- cor.test(juvenile_hares$weight, juvenile_hares$hindft)

# Tidy version of correlation output:
hares_cor_tidy <- tidy(hares_cor)

ggplot(data = juvenile_hares, aes(x = hindft, y = weight)) +
  geom_point() +
  geom_smooth(method = "lm")
```

In 2 - 3 sentences below your figure, describe the outcome of your linear regression exploration (e.g. slope interpretation, R2 value, and Pearson's r correlation) and touch briefly on which assumption(s) of linear regression may be a concern, and additional thoughts you have about how well (or not well…) the linear model describes the relationship. What worries you? 

Summary: Include a very short summary describing your main findings from your juvenile hares exploration (bullet points are fine)
